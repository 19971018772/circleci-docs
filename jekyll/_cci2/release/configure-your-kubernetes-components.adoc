---
contentTags:
  platform:
  - Cloud
---
= Configure your Kubernetes components - Open preview
:page-layout: classic-docs
:page-liquid:
:page-description: Tutorial outlining how to configure your Kubernetes components for visibility and control on the releases dashboard.
:icons: font
:experimental:

NOTE: CircleCI releases is currently in **open preview**

Visualise and control deployments to your Kubernetes cluster with CircleCI release environments. The steps outlined on this page guide you to set up a release environment and install the CircleCI release agent into your Kubernetes cluster.

[#introduction]
== Introduction

In this tutorial you will configure your Kubernetes components, adding labels and annotations to enable visibility and control over your deployments, and access to the following features:

* Restore a version
* Scale a version
* Restart a version
* Retry a release (when using Argo Rollouts)
* Promote a release (when using Argo Rollouts)
* Cancel a release (when using Argo Rollouts)

[#prerequisites]
== Prerequisites

Before following the steps below, ensure the release environment has been successfully set up. Refer to the xref:set-up-a-release-environment#[Set up a release environment] page.

[#add-required-labels]
== 1. Add required labels to your Deployment/Rollout

To enable your release to show up on the releases dashboard in the CircleCI web app, add the following labels to your Kubernetes Deployment or Argo Rollout:

* Specify the `app` and `version` label in the Kubernetes object `Metadata.Labels`
* Specify the `app` and `version` label in the Kubernetes object `Spec.Template.Metadata.Labels`

For example:

[,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  labels:
    app: example-deployment
    version: 1.0.0
  name: example-deployment
  namespace: default
----

#At this point could they go and check in the app to see if they see it? Or should that wait until they actually do a release?#

[#link-release]
== 2. Link release to deployment job trigger (optional)

You can link your release with the CircleCI _deployment_ job that triggered it. To do this, add the following annotations to your Deployment/Rollout. The method for incorporating these values and variables will depend on you config and tooling:

* `circleci.com/job-number` should be set to the `CIRCLE_BUILD_NUM` xref:../variables#built-in-environment-variables[environment variable].
* `circleci.com/pipeline-id` should be set to the `pipeline.id` xref:../variables#pipeline-values[pipeline value].
* `circleci.com/workflow-id` should be set to the `CIRCLE_WORKFLOW_ID` xref:../variables#built-in-environment-variables[environment variable].

Once these values and variables are rendered, the config will look something like:

[,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    circleci.com/job-number: "1"
    circleci.com/pipeline-id: 88dfee99-0348-407f-b113-dbf270cad093
    circleci.com/workflow-id: 5b8c4de8-fd5f-4be2-80a4-3d0c03fc138c
----

[#enable-release-management]
== 3. Enable release management (optional)

By adding a few additional annotations to your Kubernetes objects (Deployment/Rollout), you can enable additional actions on your releases dashboard, such as restoring, scaling, and restarting component versions. To get started, add the `circleci.com/project-id` annotation with the value found on the relevant CircleCI project settings page.

[,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    ...
    circleci.com/project-id: 9da0c100-3295-49a4-827f-7892f3e8dc83
----

#Screenshot#

[#operation-timeout]
=== a. Custom operation timeout

The `circleci.com/operation-timeout` annotation allows a custom timeout to be specified for Helm Rollback operations performed as part of a Restore Version command. Valid values are Go duration strings (for example, 5m, 10m15s). This option is available if you are using Helm to manage your Kubernetes resources.

For example,

[,yaml]
----
annotations:
  circleci.com/operation-timeout: 10m
----

[#opt-out-ui-based-actions]
=== b. Opt out of UI-based actions

[#example-deployment]
== Example Deployment



[#conclusion]
== Conclusion

In this tutorial you have configured your Kubernetes components for visibility and control from the CircleCI releases dashboard.

[#next-steps]
== Next steps

// Here you can inlude links to other pages in docs or the blog etc. where the reader should head next.
* xref:../benefits-of-circleci#[Benefits of CircleCI]
* xref:../concepts#[CircleCI concepts]
