---
layout: classic-docs
contentTags:
  platform:
    - Cloud
    - Server v4.x
    - Server v3.x
---
= Dynamic configuration overview
:description: A guide to using CircleCI's dynamic configuration features
:page-layout: classic-docs
:page-liquid:
:icons: font
:experimental:

Dynamic configuration in CircleCI is the process of describing a pipeline in which the work is dynamically determined. Dynamic configuration is flexible. The features described in this guide allow you to create a configuration to match the requirements of your specific project.

Dynamic configuration can mean:

* The work is determined by values passed in at runtime as _pipeline parameters_.
* The configuration file is dynamically generated by the pipeline using a template rather than being static YAML
* A project's configuration is pieced together dynamically depending on specific xref:pipeline-variables#[Pipeline values] or file paths.
* Using conditional logic and parameterization to determine the work to be done.
* Trigger pipelines defined by configurations that exist outside the default parent `.circleci/` directory.

== Quickstart

=== Enable dynamic configuration

NOTE: Projects created **after** December 1st 2023 have dynamic config enabled by default. If this applies to your project, you can skip this step.

To enable dynamic configuration in CircleCI:

. In the CircleCI web app, select **Projects** in the sidebar
. Click the icon:elipsis[] next to your project and select **Project Settings**
. From the sidebar, select *Advanced*.
. Scroll to the *Enable dynamic config using setup workflows* setting, and toggle it to the "on" position, as shown below:
+
image:{{site.baseurl}}/assets/img/docs/dynamic-config-enable.png[Enable dynamic config in the UI]

These steps make dynamic configuration features available for your project, but any _static_ `config.yml` you have previously set up will continue to work as normal.

=== Use dynamic configuration

Add the key `setup: true` to the top level of your _parent_ configuration file to designate that `config.yml` as a `setup` configuration.

[,yaml]
----
version: 2.1

setup: true
----

For some basic examples of using dynamic configuration, see the xref:using-dynamic-configuration#[Using dynamic configuration] how-to guide.

== Config continuation constraints

There are some constraints on continuing pipelines from a `setup` configuration, as follows:

- The `setup` configuration must be `version: 2.1`.
- The `setup` configuration must only allow one continuation workflow to run in each pipeline. This can be done by having only one workflow that uses a call to the continuation API endpoint, eothjer directly or using an orb, or by using logic conditions to ensure only one continuation is allowed at a time.
- A pipeline can only be continued once. A pipeline cannot be continued with another setup configuration.
- A pipeline can only be continued within six hours of its creation.
- Pipeline parameters submitted at continuation time cannot overlap with pipeline parameters submitted at trigger (setup) time.
- Pipeline parameters declared in the `setup` configuration must also be declared in the continuation configuration. These parameters can be used at continuation time. For more information, see the xref:pipeline-variables#pipeline-parameters-and-dynamic-configuration[Pipeline values and parameters] page.

== Dynamic configuration examples

Some examples of using dynamic configuration in CircleCI include:

* Incorporate logic to check for file changes or parameter values so that only necessary work is done in each pipeline.
* Share common configuration across projects by generating project-specific sections dynamically based on parameters.
* _Continue_ a pipeline, or generate and run a configuration based on where code has changed.
* Split up a configuration file into reusable fragments that can be dynamically assembled.
* Generate full CircleCI configurations from small company-specifiic configurations. For example, if you have many repositories with similar CI/CD requirements, you can generate a full CircleCI YAML configuration dynamically from small template configuration written in any configuration language.
* When working with a language or framework that has its own configuration language, you can generate CircleCI config dynamically from existing configuration files.

[#how-dynamic-config-works]
== How dynamic config works

CircleCI's dynamic configuration feature is made up of the following resources. These resoruces can be used together to fit a variety of use cases:

* The xref:configuration-reference#setup[`setup` config field] allows you to designate a configuration file as _dynamic_, allowing the use of dynamic configuration features. When a configuration is dynamic (`setup: true`) the `CIRCLE_CONTINUATION_KEY` environment variable is available. `CIRCLE_CONTINUATION_KEY` is required to authorize the continuation of one configuration to another via the link:https://circleci.com/docs/api/v2/index.html#operation/continuePipeline[continue a pipeline] API v2 endpoint.

* Use the API v2 link:https://circleci.com/docs/api/v2/index.html#operation/continuePipeline[continue a pipeline] endpoint to continue a pipeline from one configuration to another. This endpoint can be used directly or via one of the dynamic configuration orbs described next.

* Use the link:https://circleci.com/developer/orbs/orb/circleci/path-filtering[path filtering orb] to map filepaths, pipelines parameters, and configuration files to determine the work that should be done when a change happens in a specific location in a repository.

* Use the link:https://circleci.com/developer/orbs/orb/circleci/continuation[continuation orb] to continue one configuration to another and set up any required pipeline parameters.

CircleCI's dynamic configuration feature uses setup workflows. A _setup workflow_ can contain jobs that compute pipeline parameters, which can then be passed into an additional configuration that potentially exists in other directories. A setup workflow can also be used to generate new configurations via pre-existing scripts. In any case, the setup workflow continues the pipeline on to the desired next configuration.

Behind the scenes, the _continuation_ configuration is implemented as a call to a public _pipeline continuation_ API. This API accepts a _continuation key_, which is a secret, unique-per-pipeline key that is automatically injected into the environment of jobs executed as part of the initial setup workflow. The API also accepts a configuration string, as well as a set of pipeline parameters.

== Use path filtering for monorepos

This becomes particularly helpful in cases where your team is using a monorepo, or a single repository, as opposed to using multiple repositories to store your code.

For instance, you may want to use dynamic configuration to trigger certain workflows based on which files or subdirectories have changed in your repository. Otherwise, all of your microservices/sub-projects would go through the entirety of your build, test, and deployment processes when any single update is introduced. This scenario is also referred to as _path filtering_.

== Use config splitting for microservices

Another scenario in which you could use dynamic configuration is when your project consists of multiple modules, where each module requires a separate job. These jobs could be stored in multiple files as _fragments_ of a configuration. Instead of using one full `.circleci/config.yml` file, you could use dynamic configuration to combine these individual fragments into a full configuration when a pipeline is triggered. This scenario can also be referred to as _config splitting_.

== Using dynamic configuration on CircleCI server

TIP: For more information on managing orbs in a server installation see the xref:/server/v4.5/operator/managing-orbs#[Managing orbs] page.

If you are using CircleCI server there are a few extra steps you will need to take to use the dynamic configuraiton orbs.

* You will need to import the path filtering and continuation orbs into your server installation using the following commands:
+
NOTE: These examples show importing the most recent versions of the orbs. You can also specify a semver version constraint to import a specific version, for example, `circleci/continuation@1.0.0`.
+
[,yaml]
----
circleci admin import-orb circleci/path-filtering --host <your-server-installation-domain> --token <your-api-token>
----
+
[,yaml]
----
circleci admin import-orb circleci/continuation --host <your-server-installation-domain> --token <your-api-token>
----

When using the path filtering orb on server you will need to add your CircleCI server domain to the `path-filtering/filter` job in your workflow, for example:

[,yaml]
----
workflows:
  setup-workflow:
    jobs:
      - path-filtering/filter:
          mapping: |
            packages/api/.* api true
            packages/auth/.* auth true
            packages/e2e/.* e2e true
            packages/unit/.* unit true
          # # Optional, defaults to main:
          base-revision: main
          circleci_domain: support-server-4.eks-dev.sphereci.com
----

[#dynamic-config-faqs]
== FAQs

include::../_includes/snippets/faq/dynamic-configuration-faq-snip.adoc[]

[#what-to-read-next]
== Next steps

- A how-to guide for xref:using-dynamic-configuration#[Using dynamic configuration]
- The link:https://circleci.com/developer/orbs/orb/circleci/continuation[`continuation` orb]
- The link:https://circleci.com/docs/api/v2/#operation/continuePipeline[`continuePipeline` API call]
