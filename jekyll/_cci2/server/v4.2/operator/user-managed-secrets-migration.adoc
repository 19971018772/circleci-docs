---
contentTags:
  platform:
    - Server v4.2
    - Server Admin
---
= User authentication
:page-layout: classic-docs
:page-liquid:
:page-description: CircleCI server supports autogeneration of few secrets if not present
:icons: font
:toc: macro
:toc-title:

These instructions explain how to migrate user managed secrets when upgrading from Server 4.1.x to Server 4.2.

NOTE: In the following sections, replace any sections indicated by `< >` with your details.

With Server 4.2, CircleCI Server auto-generates below secrets if not present in the k8s namespace.
- xref:../installation/phase-2-core-services#api-token[api-token]
- xref:../installation/phase-2-core-services#session-cookie[session-cookie]
- xref:../installation/phase-2-core-services#pusher-kubernetes-secret[pusher]
- xref:../installation/phase-3-execution-environments#nomad-gossip-encryption-key[nomad-gossip-encryption-key]

If you have above secrets as user managed, please follow below steps to let CircleCI Server know that these secrets are already existing before upgrading to Server 4.2.

[source,shell]
----
kubectl -n <namespace> annotate secret/<secret-name> \
  meta.helm.sh/release-name=<helm-release-name> \
  meta.helm.sh/release-namespace=<namespace> \
  helm.sh/resource-policy=keep --overwrite

kubectl -n <namespace> label secret/<secret-name> \
  app.kubernetes.io/managed-by=Helm --overwrite
----