//[#circleci-web-app-installation]
//== CircleCI web app installation

[.tab.container-runner.Web_app_installation]
--
In order to install self-hosted runners, you will need to create a namespace and resource class token. Please note that to create resource classes and tokens, you need to be an organization admin in the VCS provider. You can read about namespaces and resource classes on the <<runner-concepts#namespaces-and-resource-classes,Concepts>> page.

You can view your runners on the inventory page, by clicking *Self-Hosted Runners* on the left navigation.

. On the https://app.circleci.com/[CircleCI web app], navigate to *Self-Hosted Runners*.
+
image::{{site.baseurl}}/assets/img/docs/runnerui_step_one.png[Runner set up, step one - Get started]

. If this is your organization's first time using self-hosted runners, you'll need to create a namespace as the first part of this step. *Each organization can only create a single namespace*. While not required, we suggest using a lowercase representation of your CircleCI account name. CircleCI will populate your org name as the suggested namespace by default in the UI.

. If your organization already use orbs, do not create a new namespace, enter the namespace your organization uses for orbs.

. The second input field is to create a name for your resource class for your organization's self-hosted runners.
+
image::{{site.baseurl}}/assets/img/docs/runnerui_step_two.png[Runner set up, step two - Create a namespace and resource class]

. Copy and save the resource class token. Self-hosted runners use this token to claim work for the associated resource class.
+
image::{{site.baseurl}}/assets/img/docs/runnerui_step_three.png[Runner set up, step three - Create a resource class token]
+
CAUTION: The token cannot be retrieved again, so be sure to store it safely.

. You will need to follow the platform-specific installation instructions to continue. There is a **Container** tab for setting up container runner, as well as a **Machine** tab for setting up self-hosted runners in Linux, macOS, and Windows. Click the tab in the UI that is relevant to your environment.
ifdef::container[]
+
.Install container runner through the web app
image::runnerui_step_four_cr.png[Container runner in the web app]
+
endif::[]
ifdef::machine[]
+
.Install machine runner through the web app
image::runnerui_step_four.png[Machine runner in the web app]
+
endif::[]
The instructions for specific platforms can be found in the web app, but are also included in a later section in this installation guide.

. You will be presented with configuration code for your new resource class. If you have an existing `.circleci/config.yml` file, add your new resource class below the existing `jobs` section, or add the whole `jobs` section if one doesn't exist in your config. If you don't have an existing `.circleci/config.yml` file, you can create the file and copy all of the code over.
+
image::{{site.baseurl}}/assets/img/docs/runnerui_step_five.png[Runner set up, copy code to config file]
--
[.tab.container-runner.CLI_installation]
--
//[#command-line-installation]
//== Command line installation

NOTE: If you are installing **self-hosted runners for server**, the CircleCI CLI needs to be configured using your server API key. Run `circleci setup` to configure the CLI and access the option to supply a new API token if required.

In order to install self-hosted runners, you will need to create a namespace and authentication token by performing the steps listed below. Please note that to create resource classes and tokens you need to be an organization administrator in the VCS provider.

You can view your runners on the inventory page, by clicking *Self-Hosted Runners* on the left navigation.

. Create a namespace for your organization's self-hosted runners. Please note, CircleCI will autogenerate a namespace based on your organization's name. Verify this is the namespace you want to use. *Each organization can only create a single namespace*. We suggest using a lowercase representation of your CircleCI organization's account name. If you already use orbs, this namespace should be the same namespace orbs use.
+
If you receive an error creating a namespace, check to see if you have an existing one, and move on to step 2 below, using your existing namespace.
+
It is recommended to use the following command to create a namespace:
+
```
circleci namespace create <name> --org-id <your-organization-id>
```
+

. Create a resource class for your self-hosted runner's namespace using the following command:
+
```
circleci runner resource-class create <namespace>/<resource-class> <description> --generate-token
```
+
*Your namespace is required in the command to create your resource class.*
Example: `circleci runner resource-class create my-namespace/my-resource-class my-description --generate-token`.
+

CAUTION: The token cannot be retrieved again, so be sure to store it safely.

*If you are using Linux, macOS, or Server, continue with the directions below.* Otherwise, skip to the <<#platform-specific-instructions, Platform-specific installation>> instructions.

[#continued-for-linux-macos-and-server]
== Continued for Linux, macOS, and Server

Be sure to complete the steps in the <<#command-line-installation, Command line installation>> section before moving on to the steps below.

. Save the script below as `download-launch-agent.sh` in the root of your project. When run (see the next step) the script will download the launch-agent binary, verify the checksum, and set the `circleci-launch-agent` version.
+
Self-hosted runners on cloud auto-update to the latest supported versions. For server, specific self-hosted runner versions are validated for interoperability, and self-hosted runners do not auto-update.
+
```shell
#!/usr/bin/env sh

set -eu pipefail

echo "Installing CircleCI Runner for ${platform}"

base_url="https://circleci-binary-releases.s3.amazonaws.com/circleci-launch-agent"
if [ -z ${agent_version+x} ]; then
  agent_version=$(curl "${base_url}/release.txt")
fi

# Set up runner directory
echo "Setting up CircleCI Runner directory"
prefix=/var/opt/circleci
sudo mkdir -p "${prefix}/workdir"

# Downloading launch-agent (machine runner)
echo "Using CircleCI Launch Agent version ${agent_version}"
echo "Downloading and verifying CircleCI Launch Agent Binary"
curl -sSL "${base_url}/${agent_version}/checksums.txt" -o checksums.txt
file="$(grep -F "${platform}" checksums.txt | cut -d ' ' -f 2 | sed 's/^.//')"
mkdir -p "${platform}"
echo "Downloading CircleCI Launch Agent: ${file}"
curl --compressed -L "${base_url}/${agent_version}/${file}" -o "${file}"

# Verifying download
echo "Verifying CircleCI Launch Agent download"
grep "${file}" checksums.txt | sha256sum --check && chmod +x "${file}"
sudo cp "${file}" "${prefix}/circleci-launch-agent" || echo "Invalid checksum for CircleCI Launch Agent, please try download again"
```
+
. Set your platform and run the `download-launch-agent.sh` script to download, verify, and install the binary. If you are using **cloud**, use the table below to find your platform variable:
+
[.table.table-striped]
[cols=2*, options="header", stripes=even]
|===
| Installation Target
| Variable

| For Linux x86_64
| `platform=linux/amd64`

| For Linux ARM64
| `platform=linux/arm64`

| For Linux s390x
| `platform=linux/s390x`

| For Linux ppc64le
| `platform=linux/ppc64le`

| For macOS x86_64
| `platform=darwin/amd64`

| For macOS M1
| `platform=darwin/arm64`
|===
+
For example, on **cloud**, to set your platform for macOS M1 and run the `download-launch-agent.sh` script, run the following:
+
```shell
export platform=darwin/arm64 && sh ./download-launch-agent.sh
```
+
For *server v3.1.0 and up*, use the table below to find the compatible machine runner launch-agent version for the version of server you are running:
+
[.table.table-striped]
[cols=2*, options="header", stripes=even]
|===
| Server version
| Launch agent version

| 3.0
| Runner not supported

| 3.1
| 1.0.11147-881b608

| 3.2
| 1.0.19813-e9e1cd9

| 3.3
| 1.0.29477-605777e

| 3.4
| 1.0.48283-583799b

| 4.0
| 1.0.48283-583799b
|===
+
Substitute `<launch-agent-version>` with your launch-agent version for server and run the following:
+
```shell
export agent_version="<launch-agent-version>" && sh ./download-launch-agent.sh
```
+
**Note:** Once your runner is successfully set up, you can delete the `download-launch-agent.sh` file.
+
. Continue with the platform-specific instructions in the next section.
--