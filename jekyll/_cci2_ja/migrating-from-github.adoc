---

version:
- クラウド
- Server 3.x
---
= Github Actions からの移行
:page-layout: classic-docs
:page-liquid:
:page-description: GitHub Actions から CircleCI に移行する方法を概説します。
:icons: font
:toc: macro

:toc-title:

このドキュメントでは、GitHub Actions から CircleCI に移行する方法を概説します。

[#why-migrate-to-circleci]
== CircleCI に移行する理由

CircleCI は、大変優れた CI ツールです。 8 年前に設立して以来、CI/CD は弊社の専門分野です。 通常の CI/CD ツールに求められる機能に加えて、CircleCI が他と一線を画すのは、生産性を高める以下のような機能です。

1. **高度なキャッシュ** - https://circleci.com/docs/caching/#full-example-of-saving-and-restoring-cache[通常の依存関係のキャッシュ] に加えて、CircleCI では https://circleci.com/docs/docker-layer-caching/[Docker イメージレイヤー] に特化したキャッシュを提供しています。 これは、Docker イメージの後続のビルドがより速く実行されることを意味し、コミットからデプロイまでのワークフローにかかる時間をさらに短縮できます。
1. **ビルドへの SSH 接続** - CircleCI は、 https://circleci.com/docs/ssh-access-jobs/[実行環境への安全な SSH 接続] 機能を提供しており、ログの監視、ファイルの操作、および各環境と直接やり取りすることが可能です。 これは、失敗したビルドのデバッグに非常に役立ちます。
1. **リソースクラス** - プラットフォーム上でさまざまなサイズの https://circleci.com/docs/optimizations/#resource-class[Executor] を使用することができ、Node 上のワークロードの大きさに応じた調整に最適です。
1. **Test Parallelism** - our platform provides not only https://circleci.com/docs/workflows/[concurrent job execution] but also the ability to split tests between parallel environments. You can dramatically cut build times by https://circleci.com/docs/parallelism-faster-jobs/#using-the-circleci-cli-to-split-tests[splitting workloads between different containers].

その他にも、CircleCI ソリューションを特徴づける様々な機能があります。 https://circleci.com/signup/[Sign up for a free account today] and try us out, or if you are interested in CircleCI for your team, https://circleci.com/talk-to-us/?source-button=MigratingFromGitHubActionsDoc[contact our sales team] to set up a trial.

[#concepts]
== コンセプト

[#jobs-and-workflows]
=== ジョブとワークフロー

GitHub Actions と CircleCI には、「ジョブ」と「ワークフロー」という似たような概念があります。 ワークフローは、複数のジョブのエンド ツー エンドの流れであり、ジョブは小さなタスク（例えば、「ユニットテストの実行」や「Docker イメージのビルド」）を実行するためのコマンドで構成されています。

主に異なる点は、CircleCI では設定構文においてワークフローとジョブの依存関係をジョブのインラインではなく別のセクションで設定します。

[.table.table-striped.table-migrating-page.table-no-background]
[cols=2*, options="header", stripes=even]
[cols="50%,50%"]
|===
|GitHub |CircleCI

a|[source, yaml]
----
name: GitHub Actions のワークフロー

on: [push]

jobs:
  job_1:
    runs-on: ubuntu-latest
    steps:
      # ジョブのステップです。
  job_2:
    needs: job_1
    runs-on: ubuntu-latest
    steps:
      # ジョブのステップです。

----
|[source, yaml]
----
jobs:
  job_1:
    executor: my-ubuntu-exec
    steps:
      # ジョブのステップです。
  job_2:
    executor: my-ubuntu-exec
    steps:
      # ジョブのステップです。

workflows:
  my_workflow:
    jobs:
      - job_1
      - job_2:
          requires:
            - job_1
----
|===

[#actions-vs-orbs]
=== Actions と Orb の比較

GitHubの「アクション」とは、ジョブ内で実行する再利用可能なコマンドやタスクのことです。 しかし、それらは Docker コンテナ内で実行するように書かれていたり、JavaScript で個々のステップとしてコーディングされています。 そのため、作業が増え、適用できる範囲が限られてしまいます。

CircleCI offers similar functionality in our https://circleci.com/docs/orb-intro/#section=configuration[orbs]. 主な違いは、CircleCI の Orb はパッケージ化された再利用可能なYAMLであり、再利用可能なジョブ、Executor、またはコマンドを 「Orb 化」し、ジョブやワークフローの中で適切に使用することができます。

GitHub offers browsing of Actions in their Marketplace; CircleCI has an https://circleci.com/developer/orbs[Orb Registry] as well as an https://circleci.com/integrations/[Integrations Page] containing numerous Certified, Partner, and community orbs / integrations.

[#runners-vs-executors]
=== ランナーと Executor の比較

In GitHub, you can specify your builds to run in Linux, macOS, and Windows environments via a `runs-on` key in the YAML, and if you want to run anything in a container, you specify an additional `container` key.

CircleCI では、同じように環境（Executorと呼ばれる）を選択でき、Docker 用のオプションや機能が追加されています。

For each of the https://circleci.com/docs/executor-intro/[executor types], you have a choice of different versions which will subsequently have various versions of base software installed.

以下の表を参照して設定を比較してください。

[#configuration-comparison]
== 設定の比較

[.table.table-striped.table-migrating-page]
[cols=2*, options="header,unbreakable,autowidth", stripes=even]
[cols="5,5"]
|===
|GitHub の設定 |CircleCI の設定

2+|実行環境の指定:  While container execution is specified separately in GitHub, +
`docker` is its https://circleci.com/docs/configuration-reference/#docker-machine-macos-windows-executor[own class of executor] in CircleCI.

a|[source, yaml]
----
# オペレーティングシステムを選択します。
runs-on: ubuntu-latest # or windows, etc.

# コンテナでステップを実行する場合は、
container:
  image: openjdk:17.0-jdk
----
|[source, yaml]
----
# Docker (container) Executor
docker:
  - image: cimg/openjdk:17.0
    auth:
      username: mydockerhub-user
      password: $DOCKERHUB_PASSWORD  # context / project UI env-var reference

# Linux Ubuntu Executor
machine: true

# macOS Executor
macos:
  xcode: 12.5.1

# Windows Executor
# NOTE: Orb declaration needed. See docs
executor: win/vs2019

----

2+|依存関係/サービスの指定:  All images specified after the first in CircleCI are treated https://circleci.com/docs/configuration-reference/#docker[as dependencies].

a|[source, yaml]
----
jobs:
  build:
    runs-on: ubuntu-latest

    # メインのコンテナです。
    container:
      image: openjdk:17.0-jdk

    # 依存関係のサービスです。
    services:
      postgres:
        image: postgres:10.8
        env:
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: postgres
----
|[source, yaml]
----
jobs:
  build:
    docker:
      # Primary Executor
      - image: cimg/openjdk:17.0
        auth:
          username: mydockerhub-user
          password: $DOCKERHUB_PASSWORD  # context / project UI env-var reference

      # Dependency Service(s)
      - image: postgres:10.8
        auth:
          username: mydockerhub-user
          password: $DOCKERHUB_PASSWORD  # context / project UI env-var reference
        environment:
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: postgres

----

2+|Specifying steps to https://circleci.com/docs/configuration-reference/#run[run] in a job. 同じような機能ですが、構文が異なります。

a|[source, yaml]
----
jobs:
  build:
    # ここでランナーを設定します。

    steps:
      - name: Gradle でビルド
        run: ./gradlew build
----
|[source, yaml]
----
jobs:
  build:
    # ここで Executor を設定します。

    steps:
      - run:
          name: Gradle でビルド
          command: ./gradlew build
----

2+|共有タスクの利用 (GitHub ならアクション、CircleCIなら Orb): In CircleCI, you declare orbs at the top level +
and then https://circleci.com/docs/configuration-reference/#orbs-requires-version-21[refer to them by name in config], similar in concept to Python or JavaScript imports.

a|[source, yaml]
----
jobs:
  build:
    # ここでランナーを設定します。

    steps:
      - name: Slack の通知
        uses: rtCamp/action-slack-notify@v1.0.0
        env:
          SLACK_COLOR: '#32788D'
          SLACK_MESSAGE: 'Tests passed'
          SLACK_TITLE: Slack Notify GA
          SLACK_USERNAME: Bobby
          SLACK_WEBHOOK: # WEBHOOK

----
|[source, yaml]
----
orbs:
  slack-orb: circleci/slack@3.4.0

jobs:
  build:
    # ここで Executor を設定します。

    steps:
      - slack-orb/notify:
          color: '#32788D'
          message: Tests passed
          title: Testing Slack Orb
          author_name: Bobby
          webhook: # WEBHOOK
----

2+|ワークフローでの条件付きステップの使用: CircleCI offers https://circleci.com/docs/configuration-reference/#the-when-attribute[basic conditions on steps] (e.g., on_success [default], +
on_success, on_failure) as well as https://circleci.com/docs/configuration-reference/#the-when-step-requires-version-21[conditional steps] based on parameters. We also have https://circleci.com/docs/reusing-config/#using-the-parameters-declaration[conditional jobs], and +
currently conditional, parameterized workflows and pipelines https://github.com/CircleCI-Public/api-preview-docs/blob/master/docs/conditional-workflows.md[are in preview].

a|[source, yaml]
----
jobs:
  build:
    # ここで環境を設定します。

    steps:
      - name: 失敗したステップ
        run: echo "Failed step"
        if: failure()
      - name: 常に実行するステップ
        run: echo "Always step"
        if: always()
----
|[source, yaml]
----
jobs:
  build:
    # ここで Executor を設定します。

    steps:
      - run:
          name: 失敗したステップ
          command: echo "Failed step"
          when: on_fail
      - run:
          name: 常に実行するステップ
          command: echo "Always step"
          when: always
----
|===

For more configuration examples on CircleCI, visit our <<examples-and-guides-overview#,Examples and Guides Overview>> and <<example-configs#,Example Projects>> pages.

GitHub Actions と CircleCI の設定は似ているため、ジョブやワークフローの移行は非常に簡単です。 しかし、移行を成功させる可能性を高めるために、アイテムを以下の順序で移行することをお勧めします。

. https://circleci.com/docs/concepts/#section=getting-started[Jobs, Steps, and Workflows]
. https://circleci.com/docs/workflows/[More Advanced Workflow and Job Dependency Configuration]
. https://circleci.com/docs/orb-intro/[Actions to Orbs]. Our registry can be found https://circleci.com/developer/orbs?filterBy=all[here].
. https://circleci.com/docs/optimizations/#section=projects[Optimizations like caching, workspaces, and parallelism]