---
layout: classic-docs
title: "Ubuntu 14.04 から Ubuntu 20.04 への移行"
short-title: "14.04 から 20.04 への移行"
description: |
  CircleCI Ubuntu 14.04 イメージから CircleCI Ubuntu 20.04 イメージへの移行に役立つ情報を紹介します。 このガイドでは、一つ一つの手順を説明するのではなく変更点やよくある落とし穴について説明します。
order: 20
version:
  - クラウド
  - Server v3.x
  - Server v2.x
---

* TOC
{:toc}

## サポートされているイメージへの移行
{: #switching-to-a-supported-image }

サポートが終了したイメージから現在サポートされているイメージへの移行は簡単に行えます。 新しいイメージを使ってパイプラインを実行するために必要な作業は、プロジェクトに[下記の変更](#changes)が加えられるかどうかによって異なります。 Ubuntu 14.04 イメージと 20.04 イメージを使った場合のそれぞれの例を紹介します。

{:.tab.linuxVM.Explicit-Deprecated-Image}
```yaml
version: 2.1
jobs:
  my-job:
    machine:
      image: circleci/classic:201707-01
    steps:
      run: echo "do something"
```

{:.tab.linuxVM.Default-Deprecated-Image}
```yaml
version: 2.1
jobs:
  my-job:
    machine: true
    steps:
      run: echo "do something"
```

{:.tab.linuxVM.Supported-Image}
```yaml
version: 2.1
jobs:
  my-job:
    machine:
      image: ubuntu-2004:202201-02
    steps:
      run: echo "do something"
```

上記の 2 番目の例は、デフォルトイメージを使った例です。設定ファイルで `machine: true` を使用した場合に指定されます。 これは Ubuntu 14.04 イメージであり、サポートが終了します。 サポートされているイメージ (およびタグ) は、[開発者ハブ](https://circleci.com/developer/images?imageType=machine)でお探しください。

**注: このガイドは、弊社やお客様の移行エクスペリエンスの共有によって得られた追加情報とヒントが記載され、随時更新されます。**


## 変更点
{: #changes }

Ubuntu 14.04 と 20.04 には多くの変更点があり、移行する前に把握しておく必要があります。 変更の多くは Canonical 社 (Ubuntu を提供) が行ったものですが、 CircleCI でもプリインストールしたソフトウェアへの変更を行なっています。 それぞれの変更点を見ていきましょう。

### Ubuntu への変更
{: #change-to-ubuntu }{: #change-to-ubuntu }

- カーネル: Linux カーネルは v4.4 から v5.11 にバージョンアップしました。
- Python : Python v2 は Ubuntu からデフォルトでインストールされなくなりました。 CircleCI では現在もインストールし、バージョン管理は [Pyenv 経由](https://github.com/pyenv/pyenv)で行なっています。
- OpenSSH : OpenSSH は v8.2 にアップデートされています。 この新しいバージョンは、[GitHub のサポート終了](https://github.blog/2021-09-01-improving-git-protocol-security-github/)による影響は受けません。
  - Ubuntu では 1024 ビット以下の RSA キーは使用できなくなりました。
- GNU Toolchain
  - glibc は v2.31 にアップデートされています。
  - binutils は v2.26 にアップデートされています。
  - GCC は v9.3 にアップデートされています。
- Apt は v1.2 にアップデートされています。
- Nginx は v1.18 にアップデートされています。
- nginx-core はデフォルトでレガシー geoip モジュールが有効になっている状態でリリースされなくなりました。
- Apache has been built with TLSv1.3 support.
- Apache was updated to version 2.4.29. Additionally, HTTP/2 support is now enabled.
- LXD updated to v3.0
- PHP updated to v7.4
- Perl 5.30
- MySQL updated to v5.7
- Snap & Snapcraft - Support for running and build snap packages.
- Java - OpenJDK v11 is now the default ,however, CircleCI pre-installs more versions.
- OpenSSL upgraded from v1.1.0 to v1.1.1 enabling TLS v1.3
- netplan supports IPv6 privacy extensions.
- netplan can bring up devices without an IP for anonymous bridges.
- default DNS resolver is systemd-resolved.
- Bind 9.16
- SystemD takes over from SysV.
- gpg binary is provided by gnupg2.
- Chrony v3.5 replaces ntpd.
- Wireguard VPN support
- rustc 1.41
- HAProxy 2.0
- PostgreSQL 12

### CircleCI Software Changes
{: #circleci-software-changes }

| Software       | Ubuntu 14.04 (default) | Ubuntu 20.04 (January 2022 Q1) |
| -------------- | ---------------------- | ------------------------------ |
| AWS CLI        | 1.19.112               | 2.4.6                          |
| Google Chrome  | 54.0.2840.100          | 96.0.4664.110                  |
| Docker         | 17.09.0                | 20.10.11                       |
| Docker Compose | 1.14.0                 | 1.29.2                         |
| Firefox        | 47.0.1                 | 95.0.1                         |
| GCP CLI        | 174.0.0                | 365.0.0                        |
| Go             | 1.10.2                 | 1.17.3                         |
| Gradle         | n/a                    | 7.3.2                          |
| Heroku         | 6.99.0                 | 7.59.2                         |
| jq             | 1.5                    | 1.6                            |
| Leiningen      | 2.7.1                  | 2.9.8                          |
| Maven          | 3.2.5                  | 3.8.4                          |
| Node.js        | n/a                    | 16.13.0                        |
| npm            | n/a                    | 8.3.0                          |
| OpenJDK        | 1.8.0_131              | 11.0.13                        |
| Python2        | switch                 | switch                         |
| Python3        | 3.4.3                  | 3.9.7                          |
| Ruby           | 2.3.1                  | 3.0.2                          |
| SBT            | n/a                    | 1.5.8                          |
| yq             | n/a                    | 4.13.5                         |
