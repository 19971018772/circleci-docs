---

contentTags:
  platform:
  - クラウド
  - Server v4.x
  - Server v3.x
---
= CircleCI のセルフホストランナーの概要
:page-layout: classic-docs
:page-liquid:
:page-description: CircleCI のセルフホストランナーを使用して、独自のインフラストラクチャでジョブを実行する方法について説明します。
:icons: font
:toc: macro
:toc-title:

{% include snippets/ja/runner-1.0-deprecation-first.adoc %}

[#introduction]
== はじめに

CircleCI セルフホストランナーを使用すると、お客様のインフラストラクチャでジョブを実行できるようになります。 これにより、より幅広いアーキテクチャでビルドとテストができるようになり、環境をより細かく制御することもできるようになります。

セルフホストランナーをインストールするには、Kubernetes クラスタ内でコンテナランナーを使用する方法と、マシン実行環境内でマシンランナーを使用する方法があります。 下図は、CircleCI のコンテナランナーとマシンランナーが、既存のシステムをどのように拡張するかを示しています。

[.tab.runner.Container_runner]
--
.コンテナランナーのアーキテクチャ
image::container-runner-model.png[CircleCI's container runner architecture]
--

[.tab.runner.Machine_runner]
--
.マシンランナーのアーキテクチャ
image::runner-overview-diagram.png[CircleCI's machine runner architecture]
--

[#circleci-self-hosted-runner-operation]
== CircleCI ランナーのユースケース

CircleCI では、セルフホストランナーにより主に下記の 2 つのユースケースの実現を目指しています。

[#circleci-runner-use-cases]
== ランナーの実行環境の選択

CircleCI では、セルフホストランナー用に複数の実行環境 (コンテナとマシン) を提供しています。

* Privileged access and controls - CircleCI understands that some customers require running jobs on on-premises or limited-access infrastructure due to stricter isolation requirements. Some things the self-hosted runner enables are:
** IP restrictions - Self-hosted runners can have static IP addresses that you can control
** Identity Access Management (IAM) permissions - If you set up self-hosted runners in AWS, they can be assigned IAM permissions
** Monitor the operating system
** Connect to private networks
* Unique compute requirements - Customers who need to run jobs on an environment or architecture that CircleCI does not offer as a resource class can use the self-hosted runner to fill that need.

[#choosing-a-runner-execution-environment]
== はじめよう

CircleCI のセルフホストランナーの使用を開始するには、次の手順を実行します。

[#container-runner-use-case]
=== Container runner

CircleCI's self-hosted runner has historically executed each job using a one-to-one mapping between the CI job and a <<configuration-reference#machine,machine>> environment (virtual or physical) that has the self-hosted runner binary installed on it. Exclusively running jobs in this manner sacrifices several benefits of a container-based solution that are afforded on CircleCI’s cloud platform when using the <<using-docker#,Docker executor>>:

* The ability to seamlessly use custom Docker images during job execution
* Access to a consistent, clean containerized build environment with every job

Container runner is installed in a Kubernetes (k8s) cluster which enables you to run containerized jobs on self-hosted compute, similar to how jobs use the native Docker executor to run on CircleCI’s cloud platform. This solution allows you to run hundreds of jobs at once, scaling pods effectively to meet compute demands.

After installation of the container-agent, the container runner will claim your containerized jobs, schedule them within an ephemeral pod, and execute the work within a container-based execution environment.

Container runner allows you to use CircleCI's <<circleci-images#,convenience images>> as well as custom Docker images.

Container runner is a complement to the machine runner, not a replacement.

[#machine-runner-use-case]
=== Machine runner

Machine runner is installed either in a virtual machine, or natively on a physical machine. Each machine runner job executes in the same environment (virtual or physical) where the self-hosted runner binary is installed. CircleCI's machine runner can be installed on Linux, Windows, or macOS. Machine runner should be used if you are not running containerized CI jobs. Visit the <<docker-to-machine#, Docker to machine>> page for more examples on when to use a machine execution environment.

If you do not use Kubernetes but still want to run your CI job in a container on a self-hosted runner, you can install the machine runner in Docker.

Machine runner is not compatible with CircleCI's convenience images or custom Docker images.

[#getting-started]
== CircleCI のセルフホストランナーの操作

CircleCI のセルフホストランナーのインストール後、セルフホストランナーは `circleci.com` をポーリングして稼働し、ジョブを実行して、ステータス、ログ、アーティファクトを CircleCI に報告します。

* Provide your own platform to deploy your CircleCI's self-hosted runners (see the following <<#available-self-hosted-runner-platforms,Available self-hosted runner platforms>> section for supported platforms).
* For container runner installation, visit the xref:container-runner#[Container runner] page.
* For machine runner, visit the installation guide for your desired platform:
** xref:runner-installation-linux#[Linux]
** xref:runner-installation-mac#[macOS]
** xref:runner-installation-windows#[Windows]
** xref:runner-installation-docker#[Docker]

[#available-self-hosted-runner-platforms]
== 利用可能なセルフホストランナープラットフォーム

*サポート対象* レベルのプラットフォームでは、各システムで CircleCI セルフホストランナーのビルドとテストが完了しています。

サポート対象のプラットフォームでは、ユーザーに以下が提供されます。

* ドキュメントとベストプラクティス
* サポート: CircleCI カスタマーエンジニアによる、Advanced サービスレベルアグリーメント (SLA) の範囲内の問題解決支援

*サポート対象* の CircleCI のセルフホストランナーは、以下のプラットフォームでご利用いただけます。

**コンテナランナーとマシンセルフホストランナー:**

* Ubuntu 18.04 以降 (x86_64、ARM64)

**コンテナランナー:**

* Kubernetes (x86_64、ARM64)

**マシンランナー:**

* macOS 11.2 以降 (Intel、Apple M1)
* Windows Server 2019, 2016 (x86_64)
* Linux ディストリビューション - RHEL8、SUSE、Debian など (x86_64、ARM64、s390x、ppc64le)

CircleCI では、セルフホストランナー用の新しいプラットフォームの開発が活発に行われている際に、**プレビュー** 段階のプラットフォームをご提供する場合があります。 プレビュー段階のプラットフォームがある場合は、このセクションを更新し、そのプラットフォームの情報と制限事項を通知します。

[#limitations]
== 制限事項

標準的な CircleCI 機能のほとんどすべてがセルフホストランナージョブで使用できますが、現時点では、まだいくつかサポートされていない機能があります。

* 以下の定義済みの環境変数はランナー Executor には挿入されていません。
** `CIRCLE_PREVIOUS_BUILD_NUM`
** すべての非推奨クラウド環境変数
* Docker レイヤーキャッシュ
* コンテナランナーに関する制限事項については、 <<container-runner#limitations, コンテナランナー>> のページをご確認ください。

[#learn-more]
== 詳細

CircleCI Academy の https://academy.circleci.com/runner-course?access_code=public-2021[ランナーコース] を受講すると、お客様のインフラストラクチャでのマシンランナーのインストール方法についてさらに詳しく学ぶことができます。

[#see-also]
== 関連項目

- <<runner-concepts#,ランナーのコンセプト>>
- <<runner-installation#,Web アプリからのセルフホストランナーのインストール>>
- link:https://circleci.com/ja/changelog/self-hosted-runner/[セルフホストランナーの更新履歴 ]

- link:https://circleci.com/changelog/self-hosted-runner/[Self-hosted runner change log]